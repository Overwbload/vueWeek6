import{L as C}from"./LoadingOverlay-B2F45PNR.js";import{_ as I,r as g,o as f,c as b,b as d,a as t,d as v,t as r,F as P,g as S,e as y,w as A,f as L,v as k,h as _}from"./index-DVDudEdL.js";const q={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:p,VITE_APP_API_NAME:h}=q,E={components:{LoadingOverlay:C},data(){return{cart:{carts:[]},cart2:{carts:[]},loadingStatus:{loadingItem:""},loadingComponent:!0,form:{user:{email:"",name:"",tel:"",address:""},message:""},coupon_code:""}},methods:{getCartList(){const l=`${p}/api/${h}/cart`;this.$http.get(l).then(e=>{this.cart=e.data.data,this.cart2=JSON.parse(JSON.stringify(e.data.data)),this.loadingComponent=!1}).catch(e=>{alert(e.response.data.message)})},updateQty(l){this.loadingStatus.loadingItem=l.id,l.qty<=0&&(alert("數量必須大於0"),l.qty=1);const e=this.cart2.carts.find(n=>n.product_id===l.product_id);if(e&&e.qty!==l.qty){const n={product_id:l.product_id,qty:l.qty},i=`${p}/api/${h}/cart/${l.id}`;this.$http.put(i,{data:n}).then(s=>{this.loadingStatus.loadingItem="",alert(s.data.message),this.getCartList()}).catch(s=>{alert(s.response.data.message)})}else this.loadingStatus.loadingItem=""},delProduct(l){if(this.loadingStatus.loadingItem=l,this.cart.carts.find(n=>n.id===l)){const n=`${p}/api/${h}/cart/${l}`;this.$http.delete(n).then(i=>{alert(i.data.message),this.getCartList(),this.loadingStatus.loadingItem=""}).catch(i=>{alert(i.response.data.message)})}},delAll(){this.loadingComponent=!0;const l=`${p}/api/${h}/carts`;this.$http.delete(l).then(e=>{alert(e.data.message),this.getCartList(),this.loadingComponent=!1}).catch(e=>{alert(e.response.data.message),this.loadingComponent=!1})},sendOrder(){const l=this.form,e=`${p}/api/${h}/order`;this.$http.post(e,{data:l}).then(n=>{this.getCartList(),alert(n.data.message),this.$refs.form.resetForm()}).catch(n=>{alert(n.response.data.message)})}},mounted(){this.getCartList()}},U={class:"container"},O={class:"text-end mt-2"},N=["disabled"],w={class:"badge rounded-pill bg-primary"},B={class:"table align-middle"},T=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{class:"text-center",style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1),D=["onClick","disabled"],R={key:0,class:"fas fa-spinner fa-pulse"},M=t("div",{class:"text-success"}," 已套用優惠券 ",-1),F={class:"input-group input-group-sm"},j={class:"input-group mb-3"},J=["onUpdate:modelValue","disabled","onBlur"],Q={class:"input-group-text",id:"basic-addon2"},z={class:"text-end"},G=t("small",{class:"text-success"},"折扣價：",-1),H=t("td",{colspan:"3",class:"text-end"},"總計",-1),K={class:"text-end"},W=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),X={class:"text-end text-success"},Y={class:"my-5 row justify-content-center"},Z={class:"mb-3"},$=t("label",{for:"email",class:"form-label"},"Email",-1),tt={class:"mb-3"},et=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),st={class:"mb-3"},at=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),lt={class:"mb-3"},ot=t("label",{for:"address",class:"form-label"},"收件人地址",-1),nt={class:"mb-3"},dt=t("label",{for:"message",class:"form-label"},"留言",-1),it=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function rt(l,e,n,i,s,c){const x=g("LoadingOverlay"),u=g("v-field"),m=g("error-message"),V=g("v-form");return f(),b("div",U,[d(x,{active:s.loadingComponent,"onUpdate:active":e[0]||(e[0]=a=>s.loadingComponent=a),"is-full-page":!0},null,8,["active"]),t("div",O,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[1]||(e[1]=(...a)=>c.delAll&&c.delAll(...a)),disabled:s.loadingStatus.loadingItem!==""},[v("清空購物車 "),t("span",w,r(s.cart.carts.length),1)],8,N)]),t("table",B,[T,t("tbody",null,[s.cart.carts?(f(!0),b(P,{key:0},S(s.cart.carts,a=>(f(),b("tr",{key:a.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>c.delProduct(a.id),disabled:s.loadingStatus.loadingItem===a.id},[s.loadingStatus.loadingItem===a.id?(f(),b("i",R)):y("",!0),v(" x ")],8,D)]),t("td",null,[v(r(a.product.title)+" ",1),M]),t("td",null,[t("div",F,[t("div",j,[L(t("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":o=>a.qty=o,disabled:s.loadingStatus.loadingItem===a.id,onBlur:o=>c.updateQty(a)},null,40,J),[[k,a.qty,void 0,{number:!0}]]),t("span",Q,r(a.product.unit),1)])])]),t("td",z,[G,v(" "+r(a.total),1)])]))),128)):y("",!0)]),t("tfoot",null,[t("tr",null,[H,t("td",K,r(s.cart.total),1)]),t("tr",null,[W,t("td",X,r(s.cart.final_total),1)])])]),t("div",Y,[d(V,{ref:"form",class:"col-md-6",onSubmit:c.sendOrder},{default:A(({errors:a})=>[t("div",Z,[$,d(u,{id:"email",name:"email",type:"email",class:_(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:s.form.user.email,"onUpdate:modelValue":e[2]||(e[2]=o=>s.form.user.email=o)},null,8,["class","modelValue"]),d(m,{name:"email",class:"invalid-feedback"})]),t("div",tt,[et,d(u,{id:"name",name:"姓名",type:"text",class:_(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":e[3]||(e[3]=o=>s.form.user.name=o)},null,8,["class","modelValue"]),d(m,{name:"姓名",class:"invalid-feedback"})]),t("div",st,[at,d(u,{id:"tel",name:"電話",type:"tel",class:_(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required|regex:^(09)[0-9]{8}$",modelValue:s.form.user.tel,"onUpdate:modelValue":e[4]||(e[4]=o=>s.form.user.tel=o)},null,8,["class","modelValue"]),d(m,{name:"電話",class:"invalid-feedback"})]),t("div",lt,[ot,d(u,{id:"address",name:"地址",type:"text",class:_(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":e[5]||(e[5]=o=>s.form.user.address=o)},null,8,["class","modelValue"]),d(m,{name:"地址",class:"invalid-feedback"})]),t("div",nt,[dt,d(u,{name:"留言",as:"textarea",id:"message",class:_(["form-control",{"is-invalid":a.留言}]),cols:"30",rows:"10",rules:"",modelValue:s.form.message,"onUpdate:modelValue":e[6]||(e[6]=o=>s.form.message=o)},null,8,["class","modelValue"]),d(m,{name:"留言",class:"invalid-feedback"})]),it]),_:1},8,["onSubmit"])])])}const mt=I(E,[["render",rt]]);export{mt as default};

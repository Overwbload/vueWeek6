import{_ as P,o as r,c as i,a as t,F as v,g as y,t as b,f as u,v as p,j as w,k as x,d as M,r as m,b as h,w as I}from"./index-Dvp9cMEx.js";import{P as k}from"./PaginationComponent-TQiU0I3V.js";import{M as $}from"./modal-Bsjbe5k1.js";const D={data(){return{}},methods:{openModal(s){this.$emit("openNewModal",s)}}};function A(s,o,a,n,l,d){return r(),i("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=e=>d.openModal("new"))}," 建立新的產品 ")}const V=P(D,[["render",A]]),N={props:["products"],data(){return{}},methods:{openModal(s,o){this.$emit("openCreatedModal",s,o)}}},E={class:"table mt-4"},O=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),S={class:"text-start"},T={class:"text-start"},L={key:0,class:"text-success"},B={key:1},R={class:"btn-group"},J=["onClick"],F=["onClick"];function j(s,o,a,n,l,d){return r(),i("table",E,[O,t("tbody",null,[(r(!0),i(v,null,y(a.products,e=>(r(),i("tr",{key:e.id},[t("td",null,b(e.category),1),t("td",null,b(e.title),1),t("td",S,b(e.origin_price),1),t("td",T,b(e.price),1),t("td",null,[e.is_enabled===1?(r(),i("span",L,"啟用")):(r(),i("span",B,"未啟用"))]),t("td",null,[t("div",R,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>d.openModal("edit",e)},"編輯",8,J),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>d.openModal("delete",e)},"刪除",8,F)])])]))),128))])])}const H=P(N,[["render",j]]),q={props:["tempProduct"],data(){return{localProduct:{...this.tempProduct},bsModal:""}},methods:{confirmProduct(){this.$emit("confirm")},createImages(){this.$emit("createImg")},delImages(s){this.$emit("delImg",s)},openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},upload(){this.$emit("uploadImg")},uploadApi(){this.$emit("callUploadApi")}},mounted(){this.bsModal=new $(this.$refs.productModal)},watch:{tempProduct:{handler(s){this.localProduct=s}}}},z={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},G={class:"modal-dialog modal-xl"},K={class:"modal-content border-0"},Q=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"productModalLabel",class:"modal-title"},[t("span",null,"新增產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"row"},Y={class:"col-sm-4"},Z={class:"mb-2"},tt={class:"mb-3"},ot=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),et=["src"],lt=["for"],st=["id","onUpdate:modelValue"],dt=["src"],at=["onClick"],nt={class:"col-sm-8"},rt={class:"mb-3"},it=t("label",{for:"title",class:"form-label"},"標題",-1),ct={class:"row"},ut={class:"mb-3 col-md-6"},pt=t("label",{for:"category",class:"form-label"},"分類",-1),mt={class:"mb-3 col-md-6"},ht=t("label",{for:"unit",class:"form-label"},"單位",-1),_t={class:"row"},ft={class:"mb-3 col-md-6"},bt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Pt={class:"mb-3 col-md-6"},gt=t("label",{for:"price",class:"form-label"},"售價",-1),Mt=t("hr",null,null,-1),vt={class:"mb-3"},yt=t("label",{for:"description",class:"form-label"},"產品描述",-1),$t={class:"mb-3"},Ut=t("label",{for:"content",class:"form-label"},"說明內容",-1),Ct={class:"mb-3"},wt={class:"form-check"},xt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),It={class:"modal-footer"},kt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Dt(s,o,a,n,l,d){return r(),i("div",z,[t("div",G,[t("div",K,[Q,t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("div",tt,[ot,u(t("input",{id:"imageUrl",type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":o[0]||(o[0]=e=>l.localProduct.imageUrl=e)},null,512),[[p,l.localProduct.imageUrl]]),t("form",null,[t("input",{type:"file",class:"form-control my-2",id:"file",placeholder:"請選擇要上傳的圖片",onChange:o[1]||(o[1]=(...e)=>d.upload&&d.upload(...e)),ref:"fileInput"},null,544),t("input",{type:"submit",value:"Upload",onClick:o[2]||(o[2]=w((...e)=>d.uploadApi&&d.uploadApi(...e),["prevent"]))})])]),t("img",{class:"img-fluid",src:l.localProduct.imageUrl,alt:""},null,8,et),(r(!0),i(v,null,y(l.localProduct.imagesUrl,(e,c)=>(r(),i("span",{key:c},[t("label",{for:"imagesUrl"+c,class:"form-label mx-4"},"輸入圖片網址",8,lt),u(t("input",{id:"imagesUrl"+c,type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":g=>l.localProduct.imagesUrl[c]=g},null,8,st),[[p,l.localProduct.imagesUrl[c]]]),t("img",{src:e,alt:"",class:"img-fluid my-2"},null,8,dt),t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block my-2 w-100",onClick:g=>d.delImages(c)},"刪除圖片",8,at)])]))),128)),t("div",null,[t("button",{class:"btn btn-outline-primary btn-sm d-block my-2 w-100",onClick:o[3]||(o[3]=(...e)=>d.createImages&&d.createImages(...e))},"新增更多圖片")])])]),t("div",nt,[t("div",rt,[it,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[4]||(o[4]=e=>l.localProduct.title=e)},null,512),[[p,l.localProduct.title]])]),t("div",ct,[t("div",ut,[pt,u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":o[5]||(o[5]=e=>l.localProduct.category=e)},null,512),[[p,l.localProduct.category]])]),t("div",mt,[ht,u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":o[6]||(o[6]=e=>l.localProduct.unit=e)},null,512),[[p,l.localProduct.unit]])])]),t("div",_t,[t("div",ft,[bt,u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":o[7]||(o[7]=e=>l.localProduct.origin_price=e)},null,512),[[p,l.localProduct.origin_price,void 0,{number:!0}]])]),t("div",Pt,[gt,u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":o[8]||(o[8]=e=>l.localProduct.price=e)},null,512),[[p,l.localProduct.price,void 0,{number:!0}]])])]),Mt,t("div",vt,[yt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":o[9]||(o[9]=e=>l.localProduct.description=e)},`\r
                    `,512),[[p,l.localProduct.description]])]),t("div",$t,[Ut,u(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":o[10]||(o[10]=e=>l.localProduct.content=e)},`\r
                    `,512),[[p,l.localProduct.content]])]),t("div",Ct,[t("div",wt,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[11]||(o[11]=e=>l.localProduct.is_enabled=e)},null,512),[[x,l.localProduct.is_enabled]]),xt])])])])]),t("div",It,[kt,t("button",{type:"button",class:"btn btn-primary",onClick:o[12]||(o[12]=(...e)=>d.confirmProduct&&d.confirmProduct(...e))},"確認")])])])],512)}const At=P(q,[["render",Dt]]),Vt={props:["tempProduct"],data(){return{delModal:""}},methods:{confirmDel(){this.$emit("delProduct")},delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new $(this.$refs.delProductModal)}},Nt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Et={class:"modal-dialog"},Ot={class:"modal-content border-0"},St=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Tt={class:"modal-body"},Lt=t("strong",{class:"text-danger"},null,-1),Bt={class:"modal-footer"},Rt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Jt(s,o,a,n,l,d){return r(),i("div",Nt,[t("div",Et,[t("div",Ot,[St,t("div",Tt,[M(" 是否刪除【"+b(this.tempProduct.title)+"】 ",1),Lt,M(" 商品(刪除後將無法恢復)。 ")]),t("div",Bt,[Rt,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...e)=>d.confirmDel&&d.confirmDel(...e))},"確認刪除")])])])],512)}const Ft=P(Vt,[["render",Jt]]),jt={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:_,VITE_APP_API_NAME:f}=jt,Ht={components:{NewProductBtn:V,Pagination:k,ProductTableVue:H,ProductModal:At,DelProductModal:Ft},data(){return{tempProduct:{},products:[],isNew:!1,pagination:{},bsModal:"",formData:""}},methods:{renderProducts(s=1){const o=`${_}/api/${f}/admin/products?page=${s}`;this.$http.get(o).then(a=>{this.products=a.data.products,this.pagination=a.data.pagination}).catch(a=>{alert(a.response.data.message)})},openModal(s,o){s==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.productModalComponent.openModal(),this.$refs.productModalComponent.$refs.fileInput.value=""):s==="edit"?(this.tempProduct=JSON.parse(JSON.stringify(o)),this.isNew=!1,this.$refs.productModalComponent.openModal(),this.$refs.productModalComponent.$refs.fileInput.value=""):s==="delete"&&(this.tempProduct={...o},this.$refs.delProductModalComponent.delModalShow())},checkImagesArray(){this.tempProduct.imagesUrl&&(this.tempProduct.imagesUrl=this.tempProduct.imagesUrl.filter(s=>s!==""))},confirmProduct(){const s=!this.tempProduct.id,o=s?`${_}/api/${f}/admin/product`:`${_}/api/${f}/admin/product/${this.tempProduct.id}`,a=s?"post":"put";if(this.checkImagesArray(),!s){const n=this.products.find(l=>l.id===this.tempProduct.id);if(n&&JSON.stringify(n)===JSON.stringify(this.tempProduct)){alert("No changes made!!");return}}this.$http[a](o,{data:this.tempProduct}).then(n=>{if(n.data.success===!1){alert(n.data.message);return}this.renderProducts(),alert(n.data.message),this.$refs.productModalComponent.closeModal()}).catch(n=>{alert(n.response.data.message)})},confirmDel(){if(this.products.find(o=>o.id===this.tempProduct.id)){const o=`${_}/api/${f}/admin/product/${this.tempProduct.id}`;this.$http.delete(o).then(a=>{this.tempProduct={},this.$refs.delProductModalComponent.delModalHide(),this.renderProducts(),alert(a.data.message)}).catch(a=>{alert(a.response.data.message),console.dir(a.response.data.message)})}},createImages(){this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.push("")},delImages(s){this.tempProduct.imagesUrl.splice(s,1)},upload(){const s=this.$refs.productModalComponent.$refs.fileInput.files[0];this.formData=new FormData,this.formData.append("file-to-upload",s)},uploadApi(){if(!this.formData){alert("No file to upload");return}const s=`${_}/api/${f}/admin/upload`;this.$http.post(s,this.formData).then(o=>{alert("上傳成功"),this.tempProduct.imageUrl=o.data.imageUrl,this.$refs.productModalComponent.$refs.fileInput.value="",this.formData=""}).catch(o=>{alert(o.response.data.message)})}},mounted(){this.renderProducts()}},qt={class:"container"},zt={class:"text-end mt-4"};function Gt(s,o,a,n,l,d){const e=m("NewProductBtn"),c=m("ProductTableVue"),g=m("Pagination"),U=m("ProductModal"),C=m("DelProductModal");return r(),i(v,null,[t("div",qt,[t("div",zt,[h(e,{onOpenNewModal:d.openModal},{default:I(()=>[M("5")]),_:1},8,["onOpenNewModal"])]),h(c,{products:l.products,onOpenCreatedModal:d.openModal},null,8,["products","onOpenCreatedModal"]),h(g,{pages:l.pagination,onEmitPages:d.renderProducts},null,8,["pages","onEmitPages"])]),h(U,{ref:"productModalComponent","temp-product":l.tempProduct,onConfirm:d.confirmProduct,onCreateImg:d.createImages,onDelImg:d.delImages,onUploadImg:d.upload,onCallUploadApi:d.uploadApi},null,8,["temp-product","onConfirm","onCreateImg","onDelImg","onUploadImg","onCallUploadApi"]),h(C,{ref:"delProductModalComponent","temp-product":l.tempProduct,onDelProduct:d.confirmDel},null,8,["temp-product","onDelProduct"])],64)}const Xt=P(Ht,[["render",Gt]]);export{Xt as default};
